!function(window){function loadStorage(storageType){var storage={};Object.defineProperties(storage,{setItem:{get:function(){return function(e,t){if(arguments.length<2)throw"Not enough arguments";var r;e instanceof Array?r=e:(r=Array.apply(null,arguments),t=r.pop()),e=r[0];var n;if(1===r.length)n=t;else{n=storage.getItem(e),void 0===n&&(n={});var o=storage._.valueFromObject(n);if(null===o||"object"!=typeof o)throw"'"+e+"' is not an object";for(var a=1;a<r.length-1;a++)if(o.hasOwnProperty(r[a])||(o[r[a]]={}),null===(o=storage._.valueFromObject(o[r[a]]))||"object"!=typeof o)throw"'"+r[a]+"' is not an object";o[r[r.length-1]]=t}return storage._.define(e),storageType.setItem(e,storage._.stringify(n))}}},getItem:{get:function(){return function(e){var t;t=e instanceof Array?e:1===arguments.length?[arguments[0]]:Array.apply(null,arguments);var r=storage._.getRawItem(t);return storage._.valueFromObject(r)}}},removeItem:{get:function(){return function(e){var t;if(t=e instanceof Array?e:1===arguments.length?[arguments[0]]:Array.apply(null,arguments),t.length>1){var r=t.pop(),n=storage.getItem(t);if(void 0===n)return;if(null===n||"object"!=typeof n)throw"'"+t[t.length-1]+"' is not an object";if(!n.hasOwnProperty(r))return;delete n[r],storage.setItem(t,n)}else storageType.removeItem(t[0])}}},clear:{get:function(){return function(){var e=storageType.clear();for(var t in storage)delete storage[t];return e}}},key:{get:function(){return function(e){return storageType.key(e)}}},value:{get:function(){return function(e){return storage.getItem(storageType.key(e))}}},length:{get:function(){return storageType.length}},_:{value:{converters:{date:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$date")&&1===Object.keys(e).length},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},regexp:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$regexp")&&1===Object.keys(e).length},matchObject:function(e){return e instanceof RegExp},toJSONValue:function(e){return{$regexp:e.toString()}},fromJSONValue:function(e){var t=e.$regexp.match(/^\/((?:\\\/|[^\/])+)\/([gimy]*)$/);return new RegExp(t[1],t[2])}},binary:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$binary")&&1===Object.keys(e).length},matchObject:function(e){return void 0!==window.Uint8Array&&e instanceof window.Uint8Array||e&&e.hasOwnProperty("$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:storage._.base64.encode(e)}},fromJSONValue:function(e){return storage._.base64.decode(e.$binary)}},undefinedObj:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$undefined")&&1===Object.keys(e).length},matchObject:function(e){return void 0===e},toJSONValue:function(){return{$undefined:0}},fromJSONValue:function(){}},infnan:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$infnan")&&1===Object.keys(e).length},matchObject:function(e){return"number"==typeof e&&isNaN(e)||e===window.Infinity||e===-window.Infinity},toJSONValue:function(e){var t;return t=e===window.Infinity?1:e===-window.Infinity?-1:0,{$infnan:t}},fromJSONValue:function(e){return e.$infnan/0}},functionObj:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$function")&&1===Object.keys(e).length},matchObject:function(e){return"function"==typeof e},toJSONValue:function(e){return{$function:e.toString()}},fromJSONValue:function(obj){var matches=obj.$function.match(/^function\s?(\w*)\(([^)]*)\)\s*{([\s\S]*)}$/);if(!matches){matches=obj.$function.match(/^()\(?([^)=]*?)\)?\s*=>\s*([\s\S]*?)\s*$/);var hasCurlys=matches[3].match(/^{([\s\S]*)}$/);matches[3]=hasCurlys?hasCurlys[1]:"return "+matches[3]}var name=matches[1],args=matches[2],body=matches[3];return eval("(function(){ return function "+name+"("+args+"){ "+body+" }; })()")}},escape:{matchJSONValue:function(e){return e&&e.hasOwnProperty("$escape")&&1===Object.keys(e).length},matchObject:function(e){for(var t in storage._.converters)if("function"==typeof storage._.converters[t].matchJSONValue&&storage._.converters[t].matchJSONValue(e))return!0;return!1},toJSONValue:function(e){var t={};for(var r in e)t[r]=storage._.stringify(e[r]);return{$escape:t}},fromJSONValue:function(e){var t={};for(var r in e.$escape)t[r]=storage._.parse(e.$escape[r]);return t}}},valueFromObject:function(e){for(var t in storage._.converters)"function"==typeof storage._.converters[t].matchObject&&"function"==typeof storage._.converters[t].valueFromObject&&storage._.converters[t].matchObject(e)&&(e=storage._.converters[t].valueFromObject(e));return e},jsonValueToObject:function(e){if(null!==e&&"object"==typeof e){var t;for(t in storage._.converters)if("function"==typeof storage._.converters[t].matchJSONValue&&"function"==typeof storage._.converters[t].fromJSONValue&&storage._.converters[t].matchJSONValue(e))return storage._.converters[t].fromJSONValue(e);if(e instanceof Array)for(t=0;t<e.length;t++)e[t]=storage._.jsonValueToObject(e[t]);else for(t in e)e[t]=storage._.jsonValueToObject(e[t])}return e},objectToJsonValue:function(e){if(null!==e){var t;for(t in storage._.converters)if("function"==typeof storage._.converters[t].matchObject&&"function"==typeof storage._.converters[t].toJSONValue&&storage._.converters[t].matchObject(e))return storage._.converters[t].toJSONValue(e);if("object"==typeof e){if(e instanceof Array){var r=[];for(t=0;t<e.length;t++)r.push(storage._.objectToJsonValue(e[t]));return r}var n={};for(t in e)n[t]=storage._.objectToJsonValue(e[t]);return n}}return e},getRawItem:function(e){var t;t=e instanceof Array?e:1===arguments.length?[arguments[0]]:Array.apply(null,arguments);var r=storageType.getItem(t[0]);if(null!==r){var n=storage._.parse(r);if(t.length>1){var o=storage._.valueFromObject(n);if(null===o||"object"!=typeof o)throw"'"+t[0]+"' is not an object";for(var a=1;a<t.length-1;a++){if(!o.hasOwnProperty(t[a]))return;if(null===(o=storage._.valueFromObject(o[t[a]]))||"object"!=typeof o)throw"'"+t[a]+"' is not an object"}n=o[t[t.length-1]]}return n}},base64:{encode:function(e){return Base64.encode(e)},decode:function(e){return Base64.decode(e)}},stringify:function(e){if(storage._.isCyclic(e))throw"Cannot store cyclic objects";return JSON.stringify(storage._.objectToJsonValue(e))},parse:function(e){var t;try{t=JSON.parse(e)}catch(r){t=e}return storage._.jsonValueToObject(t)},isCyclic:function(e){function t(e){if(e&&"object"==typeof e){for(var u=0;u<n.length;u++)if(e===n[u])return r=e,!0;n.push(e);for(var c in e)if(e.hasOwnProperty(c)&&t(e[c]))return a||(o="."+c+o,r===e&&(a=!0)),!0;n.pop()}return!1}var r,n=[],o="",a=!1,u=t(e);return u&&console.log(r,o.substring(1)),u},define:function(e){storage.hasOwnProperty(e)||Object.defineProperty(storage,e,{enumerable:!0,configurable:!0,get:function(){return storage.getItem(e)},set:function(t){return storage.setItem(e,t)}})}}}});for(var BASE_64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BASE_64_VALS={"=":-1},i=0;i<BASE_64_CHARS.length;i++)BASE_64_VALS[BASE_64_CHARS.charAt(i)]=i;var Base64={encode:function(e){var t;if("string"==typeof e){var r=e;for(e=new Uint8Array(new ArrayBuffer(r.length)),t=0;t<r.length;t++){var n=r.charCodeAt(t);if(n>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");e[t]=n}}var o=[],a=null,u=null,c=null,s=null;for(t=0;t<e.length;t++)switch(t%3){case 0:a=e[t]>>2&63,u=(3&e[t])<<4;break;case 1:u|=e[t]>>4&15,c=(15&e[t])<<2;break;case 2:c|=e[t]>>6&3,s=63&e[t],o.push(BASE_64_CHARS.charAt(a)),o.push(BASE_64_CHARS.charAt(u)),o.push(BASE_64_CHARS.charAt(c)),o.push(BASE_64_CHARS.charAt(s)),a=null,u=null,c=null,s=null;break;default:throw"This shouldn't happen"}return null!==a&&(o.push(BASE_64_CHARS.charAt(a)),o.push(BASE_64_CHARS.charAt(u)),null===c?o.push("="):o.push(BASE_64_CHARS.charAt(c)),null===s&&o.push("=")),o.join("")},decode:function(e){var t=Math.floor(3*e.length/4);"="===e.charAt(e.length-1)&&(t--,"="===e.charAt(e.length-2)&&t--);for(var r=new Uint8Array(t),n=null,o=null,a=null,u=0,c=0;c<e.length;c++){var s=e.charAt(c),i=BASE_64_VALS[s];switch(c%4){case 0:if(i<0)throw new Error("invalid base64 string");n=i<<2;break;case 1:if(i<0)throw new Error("invalid base64 string");n|=i>>4,r[u++]=n,o=(15&i)<<4;break;case 2:i>=0&&(o|=i>>2,r[u++]=o,a=(3&i)<<6);break;case 3:i>=0&&(r[u++]=a|i);break;default:throw"This shouldn't happen"}}return r}};return window.Proxy?new Proxy(storage,{get:function(e,t){return t in e||e[t]?e[t]:e.getItem(t)},set:function(e,t,r){return e.setItem(t,r)}}):storage}var storage=loadStorage(localStorage);Object.defineProperties(storage,{session:{get:function(){return loadStorage(sessionStorage)}}});var i;for(i in localStorage)storage._.define(i);for(i in sessionStorage)storage.session._.define(i);Object.defineProperties(window,{storage:{get:function(){return storage}}})}(window);
(function(f){function q(l){var d={};Object.defineProperties(d,{setItem:{get:function(){return function(a,b){if(2>arguments.length)throw"Not enough arguments";var c;a instanceof Array?c=a:(c=Array.apply(null,arguments),b=c.pop());a=c[0];var h;if(1===c.length)h=b;else{h=d.getItem(a);"undefined"===typeof h&&(h={});var e=d._.valueFromObject(h);if(null===e||"object"!==typeof e)throw"'"+a+"' is not an object";for(var g=1;g<c.length-1;g++)if(e.hasOwnProperty(c[g])||(e[c[g]]={}),e=d._.valueFromObject(e[c[g]]),
null===e||"object"!==typeof e)throw"'"+c[g]+"' is not an object";e[c[c.length-1]]=b}d._.define(a);return l.setItem(a,d._.stringify(h))}}},getItem:{get:function(){return function(a){var b;b=a instanceof Array?a:1===arguments.length?[arguments[0]]:Array.apply(null,arguments);b=d._.getRawItem(b);return d._.valueFromObject(b)}}},removeItem:{get:function(){return function(a){var b;b=a instanceof Array?a:1===arguments.length?[arguments[0]]:Array.apply(null,arguments);if(1<b.length){var c=b.pop(),h=d.getItem(b);
if("undefined"!==typeof h){if(null===h||"object"!==typeof h)throw"'"+b[b.length-1]+"' is not an object";h.hasOwnProperty(c)&&(delete h[c],d.setItem(b,h))}}else l.removeItem(b[0])}}},clear:{get:function(){return function(){var a=l.clear(),b;for(b in d)delete d[b];return a}}},key:{get:function(){return function(a){return l.key(a)}}},value:{get:function(){return function(a){return d.getItem(l.key(a))}}},length:{get:function(){return l.length}},_:{value:{converters:{date:{matchJSONValue:function(a){return a&&
a.hasOwnProperty("$date")&&1===Object.keys(a).length},matchObject:function(a){return a instanceof Date},toJSONValue:function(a){return{$date:a.getTime()}},fromJSONValue:function(a){return new Date(a.$date)}},regexp:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$regexp")&&1===Object.keys(a).length},matchObject:function(a){return a instanceof RegExp},toJSONValue:function(a){return{$regexp:a.toString()}},fromJSONValue:function(a){a=a.$regexp.match(/^\/((?:\\\/|[^/])+)\/([gimy]*)$/);return new RegExp(a[1],
a[2])}},binary:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$binary")&&1===Object.keys(a).length},matchObject:function(a){return"undefined"!==typeof f.Uint8Array&&a instanceof f.Uint8Array||a&&a.hasOwnProperty("$Uint8ArrayPolyfill")},toJSONValue:function(a){return{$binary:d._.base64.encode(a)}},fromJSONValue:function(a){return d._.base64.decode(a.$binary)}},undefinedObj:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$undefined")&&1===Object.keys(a).length},matchObject:function(a){return"undefined"===
typeof a},toJSONValue:function(){return{$undefined:0}},fromJSONValue:function(){}},infnan:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$infnan")&&1===Object.keys(a).length},matchObject:function(a){return"number"===typeof a&&isNaN(a)||a===f.Infinity||a===-f.Infinity},toJSONValue:function(a){return{$infnan:a===f.Infinity?1:a===-f.Infinity?-1:0}},fromJSONValue:function(a){return a.$infnan/0}},functionObj:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$function")&&1===Object.keys(a).length},
matchObject:function(a){return"function"===typeof a},toJSONValue:function(a){return{$function:a.toString()}},fromJSONValue:function(a){var b=a.$function.match(/^function\s?(\w*)\(([^)]*)\)\s*{([\s\S]*)}$/);b||(b=a.$function.match(/^()\(?([^)=]*?)\)?\s*=>\s*([\s\S]*?)\s*$/),a=b[3].match(/^{([\s\S]*)}$/),b[3]=a?a[1]:"return "+b[3]);return eval("(function(){ return function "+b[1]+"("+b[2]+"){ "+b[3]+" }; })()")}},escape:{matchJSONValue:function(a){return a&&a.hasOwnProperty("$escape")&&1===Object.keys(a).length},
matchObject:function(a){for(var b in d._.converters)if("function"===typeof d._.converters[b].matchJSONValue&&d._.converters[b].matchJSONValue(a))return!0;return!1},toJSONValue:function(a){var b={},c;for(c in a)b[c]=d._.stringify(a[c]);return{$escape:b}},fromJSONValue:function(a){var b={},c;for(c in a.$escape)b[c]=d._.parse(a.$escape[c]);return b}}},valueFromObject:function(a){for(var b in d._.converters)"function"===typeof d._.converters[b].matchObject&&"function"===typeof d._.converters[b].valueFromObject&&
d._.converters[b].matchObject(a)&&(a=d._.converters[b].valueFromObject(a));return a},jsonValueToObject:function(a){if(null!==a&&"object"===typeof a){for(var b in d._.converters)if("function"===typeof d._.converters[b].matchJSONValue&&"function"===typeof d._.converters[b].fromJSONValue&&d._.converters[b].matchJSONValue(a))return d._.converters[b].fromJSONValue(a);if(a instanceof Array)for(b=0;b<a.length;b++)a[b]=d._.jsonValueToObject(a[b]);else for(b in a)a[b]=d._.jsonValueToObject(a[b])}return a},
objectToJsonValue:function(a){if(null!==a){for(var b in d._.converters)if("function"===typeof d._.converters[b].matchObject&&"function"===typeof d._.converters[b].toJSONValue&&d._.converters[b].matchObject(a))return d._.converters[b].toJSONValue(a);if("object"===typeof a){if(a instanceof Array){var c=[];for(b=0;b<a.length;b++)c.push(d._.objectToJsonValue(a[b]));return c}c={};for(b in a)c[b]=d._.objectToJsonValue(a[b]);return c}}return a},getRawItem:function(a){var b;b=a instanceof Array?a:1===arguments.length?
[arguments[0]]:Array.apply(null,arguments);var c=l.getItem(b[0]);if(null!==c){c=d._.parse(c);if(1<b.length){c=d._.valueFromObject(c);if(null===c||"object"!==typeof c)throw"'"+b[0]+"' is not an object";for(var h=1;h<b.length-1;h++){if(!c.hasOwnProperty(b[h]))return;c=d._.valueFromObject(c[b[h]]);if(null===c||"object"!==typeof c)throw"'"+b[h]+"' is not an object";}c=c[b[b.length-1]]}return c}},base64:{encode:function(a){return n.encode(a)},decode:function(a){return n.decode(a)}},stringify:function(a){if(d._.isCyclic(a))throw"Cannot store cyclic objects";
return JSON.stringify(d._.objectToJsonValue(a))},parse:function(a){return d._.jsonValueToObject(JSON.parse(a))},isCyclic:function(a){function b(a){if(a&&"object"===typeof a){for(var k=0;k<c.length;k++)if(a===c[k])return d=a,!0;c.push(a);for(var f in a)if(a.hasOwnProperty(f)&&b(a[f]))return g||(e="."+f+e,d===a&&(g=!0)),!0;c.pop()}return!1}var c=[],d,e="",g=!1;(a=b(a))&&console.log(d,e.substring(1));return a},define:function(a){d.hasOwnProperty(a)||Object.defineProperty(d,a,{enumerable:!0,configurable:!0,
get:function(){return d.getItem(a)},set:function(b){return d.setItem(a,b)}})}}}});for(var m={"=":-1},p=0;64>p;p++)m["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p)]=p;var n={encode:function(a){var b;if("string"===typeof a){var c=a;a=new Uint8Array(new ArrayBuffer(c.length));for(b=0;b<c.length;b++){var d=c.charCodeAt(b);if(255<d)throw Error("Not ascii. Base64.encode can only take ascii strings.");a[b]=d}}var c=[],e=d=null,g=null,f=null;for(b=0;b<a.length;b++)switch(b%3){case 0:d=
a[b]>>2&63;e=(a[b]&3)<<4;break;case 1:e|=a[b]>>4&15;g=(a[b]&15)<<2;break;case 2:g|=a[b]>>6&3;f=a[b]&63;c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f));f=g=e=d=null;break;default:throw"This shouldn't happen";}null!==
d&&(c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d)),c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)),null===g?c.push("="):c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g)),null===f&&c.push("="));return c.join("")},decode:function(a){var b=Math.floor(3*a.length/4);"="===a.charAt(a.length-1)&&(b--,"="===a.charAt(a.length-2)&&b--);for(var b=new Uint8Array(b),c=null,d=null,e=null,g=0,f=0;f<a.length;f++){var k=
a.charAt(f),k=m[k];switch(f%4){case 0:if(0>k)throw Error("invalid base64 string");c=k<<2;break;case 1:if(0>k)throw Error("invalid base64 string");c|=k>>4;b[g++]=c;d=(k&15)<<4;break;case 2:0<=k&&(d|=k>>2,b[g++]=d,e=(k&3)<<6);break;case 3:0<=k&&(b[g++]=e|k);break;default:throw"This shouldn't happen";}}return b}};return d}var m=q(localStorage);Object.defineProperties(m,{session:{get:function(){return q(sessionStorage)}}});for(var n in localStorage)m._.define(n);for(n in sessionStorage)m.session._.define(n);
f.storage=m})(window);
